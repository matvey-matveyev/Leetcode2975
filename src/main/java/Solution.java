import org.junit.jupiter.api.Assertions;

import java.util.Arrays;
import java.util.Iterator;
import java.util.LinkedList;

class Solution {

    public int maximizeSquareArea(int m, int n, int[] hFences, int[] vFences) {
        int[] hDistances = everDistancesPossible(m, hFences);
        int[] hCombinations = combinations(hDistances);
        int[] vDistances = everDistancesPossible(n, vFences);
        int[] vCombinations = combinations(vDistances);
        long mm = maxMatch(hCombinations, vCombinations);
        if (mm == -1) {
            return -1;
        } else {
            return (int) (mm * mm % 1000000007);
        }
    }

    private static int[] everDistancesPossible(int n, int[] fences) {
        if (fences.length == 0) {
            return new int[] {n - 1};
        }
        java.util.Arrays.sort(fences);

        int[] distances = new int[fences.length + 1];
        distances[0] = fences[0] - 1;
        int i = 1;
        while (i < fences.length) {
            distances[i] = fences[i] - fences[i - 1];
            i++;
        }
        distances[i] = n - fences[i - 1];
        return distances;
    }

    private static class Node {
        int value;
        Node next;

        Node(int value) {
            this.value = value;
        }

        @Override
        public String toString() {
            return "{" + value + "}" + (next != null ? "->" + next.toString() : "");
        }
    }

    public static Node addSum(int sum, Node head) {
        Node prev = head;
        Node tail = head.next;
        while (tail != null && tail.value < sum) {
            prev = tail;
            tail = tail.next;
        }
        if (tail == null) {
            prev.next = new Node(sum);
            return prev.next;
        }
        if (tail.value > sum) {
            Node newNode = new Node(sum);
            prev.next = newNode;
            newNode.next = tail;
            return newNode;
        }
        return tail;
    }

    public static int[] combinations(int[] distances) {
        Node head = new Node(distances[0]);
        Node tail = head;
        for (int i = 1; i < distances.length; i++) {
            tail.next = new Node(tail.value + distances[i]);
            tail = tail.next;
        }

        for (int i = 1; i < distances.length; i++) {
            int sum = distances[i];
            if (sum < head.value) {
                Node newNode = new Node(sum);
                newNode.next = head;
                head = newNode;
                tail = head;
            } else if (sum > head.value) {
                tail = addSum(sum, head);
            } else {
                tail = head;
            }

            for (int j = i + 1; j < distances.length; j++) {
                sum += distances[j];
                tail = addSum(sum, tail);
            }
        }

        int totalNodes = 1;
        Node curr = head.next;
        while (curr != null) {
            totalNodes++;
            curr = curr.next;
        }
        int[] res = new int[totalNodes];
        curr = head;
        int idx = 0;
        while (curr != null) {
            res[idx++] = curr.value;
            curr = curr.next;
        }
        return res;
    }

    private static int maxMatch(int[] h, int[] v) {
        int hi = h.length - 1;
        int vi = v.length - 1;
        while (hi >= 0 && vi >= 0) {
            if (h[hi] == v[vi]) {
                return h[hi];
            } else if (h[hi] > v[vi]) {
                hi--;
            } else {
                vi--;
            }
        }
        return -1;
    }

    public static void main(String[] args) {
        int[] res;
        res = Solution.everDistancesPossible(20, new int[] {5, 10, 15});
        Assertions.assertArrayEquals(new int[] {4, 5, 5, 5}, res);

        res = Solution.everDistancesPossible(20, new int[] {8, 14, 17, 19});
        Assertions.assertArrayEquals(new int[] {7, 6, 3, 2, 1}, res);

        res = Solution.everDistancesPossible(20, new int[] {18, 19});
        Assertions.assertArrayEquals(new int[] {17, 1, 1}, res);

        res = Solution.everDistancesPossible(5, new int[] {2, 3, 4});
        Assertions.assertArrayEquals(new int[] {1, 1, 1, 1}, res);

        res = Solution.everDistancesPossible(5, new int[] {2, 4});
        Assertions.assertArrayEquals(new int[] {1, 2, 1}, res);

        res = Solution.everDistancesPossible(5, new int[] {3, 4});
        Assertions.assertArrayEquals(new int[] {2, 1, 1}, res);

        res = Solution.everDistancesPossible(5, new int[] {2, 3});
        Assertions.assertArrayEquals(new int[] {1, 1, 2}, res);

        res = Solution.everDistancesPossible(5, new int[] {});
        Assertions.assertArrayEquals(new int[] {4}, res);

        res = Solution.everDistancesPossible(5, new int[] {2});
        Assertions.assertArrayEquals(new int[] {1, 3}, res);

        res = Solution.combinations(new int[] {2});
        Assertions.assertArrayEquals(new int[] {2}, res);

        res = Solution.combinations(new int[] {2, 1});
        Assertions.assertArrayEquals(new int[] {1, 2, 3}, res);

        res = Solution.combinations(new int[] {1, 2});
        Assertions.assertArrayEquals(new int[] {1, 2, 3}, res);

        res = Solution.combinations(new int[] {5, 1, 2});
        Assertions.assertArrayEquals(new int[] {1, 2, 3, 5, 6, 8}, res);

        Solution s = new Solution();
        int m = 248345;
        int n = 154639;
        int[] hFences = new int[] {208209,49594,100790,40548,43497,19743,225300,88821,43500,3615,139041,62272,224730,155830,17933,1170,72250,148707,113182,232178,229607,166546,194357,190852,149674,91583,216375,234737,180027,79922,180724,59295,23658,136637,152389,19865,26456,201615,128869,73970,115630,119749,237087,133469,9692,155431,61987,125781,222609,223698,24632,73732,246898,172488,184455,109482,191795,105235,224035,136774,115610,104591,49194,169245,143270,103710,209995,163273,56637,29860,96555,21346,135245,130671,229134,105481,113307,106130,134018,87614,220220,139159,247663,200997,188889,83584,141841,227167,79554,194905,106906,207439,9449,229948,46710,204492,54483,184213,85192,52521,217021,83454,111587,81749,91304,188342,48979,184468,42492,190185,94794,189114,212446,170626,165497,1766,239588,213318,146831,145022,40371,115397,48199,199152,113666,81339,246208,98575,88012,24852,178935,90386,104891,1681,101846,120485,72736,199204,101016,170234,204687,185720,41571,68094,236228,159262,61809,210159,86022,46880,146280,157185,153874,208601,54087,246518,136423,163351,97952,79910,175889,80567,27997,76365,187947,93619,163279,225344,109348,109945,95155,139686,104557,145296,24790,91895,188396,219932,200107,200440,218889,193798,119548,172462,118640};
        int[] vFences = new int[] {41834,55201,88336,38398,33560,109872,133572,56820,84146,1482,142832,134608,154032,87178,144505,50042,61878,2234,120380,106392,21340,27008,10777,141596,9120,115413,52787,133094,69980,32918,76011,10354,106726,90150,63706,67532,14144,12705,108858,63537,32925,8079,17991,1271,141611,78560,88004,142802,61325,38148,29582,85328,105670,135621,11765,13721,102734,103201,66279,74831,17253,85311,104031,147545,89759,70705,54460,62755,134576,21141,124495,148539,137966,27453,154139,10611,31794,153631,33750,39595,15574,57286,150712,133518,95815,25165,92368,117070,139419,90443,87680,9793,72921,24767,35485,88357,36189,5788,138324,130952,34871,133295,134886,60163,150427,36425,12586,132829,12044,4341,112190,69813,137576,87299,113358,67195,29853,90978,93673,71484,14960,49959,50052,108599,130723,37470,80099,78469,48752,48024,48977,62279,126168,44675,42026,144136,87253,116316,23098,141233,145085,49753,89865,96915,154088,47287,56179,80694,40626,147797,154452,80010,64069,47910,89180,43431,37771,85601,71224,21721,28566,27640,118470,144622,46038,144571,122058,38862,75377,106233,125281,30498,59694,8776,4608,154003,107078,36081,56650,116036,53278,52627,118239,41202,66811,22125,38998,3339,31730,26586,95415,144623,150042,22954,134298,24689,88328,22126,95498,67862,78008,153287,126083,54408,124574,108174,130112,12027,95609,21031,29256,9433,50090,83184,59331,34136,4359,103322,154106,113127,134204,104702,117742,80896,56144,85472,151406,137623,75171,20413,18821,89597,74290,39378,59112,70421,86127,121971,65580,104310,104074,121530,32006,12835,30094,145074,102266,10732,11152,81536,61932,19593,41657,135814,123278,3042,94089,140268,90626,94725,98273,105267,95721,16621,5705,26427,105253,89593,105110,36377,60408,24067,24473,120708,68016,51358,18582,63468,116480,84655,109082,150815,93143,84285,90867,87528,46875,59852,14293,95594,44402,90096,17863,111537,56036,47437,75875,150249,88070,44858,82991,47100,8105,34865,134708,27570,64290,77662,31797,48267,64496,55287,99034,134023,113395,19821,144139,29118,18192,2987,74822,92671,36919,15752,89001,52706,89664,132478,18243,1694,80320,31123,18945,39894,6324,9563,55792,139770,135700,146045,8602,98003,20528,23235,3843,125692,21556,67831,147697,41620,129804,99102,11218,88037,127979,108532,47618,139888,118224,31093,38430,103805,101643,42779,10928,140741,51219,114176,106595,127158,40336,150033,11521,129973,81807,37025,145551,147772,9656,60919,3342,67576,35093,2294,77980,98460,145325,92573,64972,3165,70266,727,21730,65303,114030,110686,56160,74977,83272,106459,93353,77688,107289,74929,114244,61431,69500,752,148394,39664,18467,48659,104272,7393,72106,150809,59547,52241,12637,34056,21491,58523,39428,100683,72414,127591,139603,9082,107235,125061,18902,9716,76663,9811,143883,121592,842,27097,57616,34849,89144,149474,148694,20553,115030,154250,124977,37309,36468,54113,61148,95688,135008,150354,81513,92559,60053,71934,123020,55896,124689,116083,114325,35026,152819,137716,135148,111390,150810,42970,115493,19238};
        s.maximizeSquareArea(m, n, hFences, vFences);

        m = 236106;
        n = 234426;
        hFences = new int[] {196614,38550,208746,90177,20774,12604,97731,99543,119488,56185,114575,220992,170382,29325,207799,126621,10542,8087,9985,132387,196892,69245,182096,230113,200150,138582,152719,69434,10810,140759,113466,207746,126604,202368,112466,150186,25852,63687,94635,134482,150208,192775,135826,35541,62992,2670,122309,235809,234297,129193,34130,930,116633,160561,42304,47656,92660,141319,159742,106120,97314,217941,82849,39516,188808,111037,25097,43974,80110,34521,12778,191118,62711,169505,219274,169793,61776,82355,173894,168371,227940,141212,179138,153510,45246,168250,116982,115734,151265,136788,21678,93108,118913,182699,104873,51472,224991,115475,207277,113949,106827,228370,143827,62032,62672,142116,235576,59858,189390,128757,189721,195969,162857,221420,40619,32606,97758,97705,90013,210800,6994,183890,189496,50302,84402,165553,155336,163178,97106,181917,60440,79392,216396,64322,228519,131546,122310,22158,160743,34295,198396,33856,186988,125498,177343,119947,143564,129651,129866,49374,233167,232532,217773,67476,149495,180054,8395,223697,128080,7479,77103,100558,114407,138144,7963,158734,153452,188015,190539,53907,166119,82079,200629,221386,109878,198163,11415,202725,73591,167923,97606,101923,181674,108725,124965,124595,235419,148948,24442,83958,163876,175836,96851,99813,473,125350,99456,224968,174522,176608,24754,169667,97741,227808,41161,177164,49661,32840,95811,112671,140060,168376,204638,101152,210832,114920,55527,234825,177483,1558,206753,55779,56074,165946,29610,168600,164539,91305,200438,204873,204981,173819,213581,147952,235750,234046,184443,89281,164374,135941,175890,233348,124,225931,152156,218488,141210,156585,31711,88875,154628,235022,207160,163009,55567,155195,171286,47618,65826,151129,120410,22409,8705,112242,33322,142649,143246,22025,225008,134755,12534,230678,42321,160535,149518,36265,149379,137812,175232,107602,163749,6780,94006,105331,176352,209996,108630,28826,206087,218189,94088,211935,190971,5643,164585,75749,199153,4716,52941,32169,47062,17787,66561,206338,209928,145962,153609,97403,189266,145237,110959,159097,192721,28384,141305,159232,168341,182804,25494,52878,71052,90912,218848,126890,52309,55052,45510,59147,58967,116599,218058,184271,139847,33668,6414,102609,34010,78864,38824,34903,186605,184155,18489,95339,93734,202458,117228,87744,14824,76067,51762,123948,34647,191981,200664,16973,107433,17987,225213,34193,97252,8659,220473,71308,6983,12803,188457,175008,89763,6425,105016,2205,104147,52457,66301,14440,132511,91013,99017,78662,35005,173774,33266,76759,218837,198338,221916,90392,50789,176170,150763,106582,162808,214865,114059,32713,78350,86439,15170,63088,54344,30247,230812,140530,225280,148414,135069,182937,143139,63685,54898,120676,553,200036,55310,132831,12682,12304,336,83355,201775,212760,87992,126576,143697,31686,169869,194545,162132,190957,27587,118737,167909,70892,185827,99992,5471,106087,77002,49483,69381,108184,147986,117077,55241,195441,206414,203026,22770,103709,117466};
        vFences = new int[] {91479,165514,196415,152839,154420,205465,72004,76610,1951,213302,137159,210184,91673,213981,163450,4972,176061,35675,211726,115721,181129,172882,28362,107428,44721,36392,25577,53739,179736,170669,173327,122010,195326,5668,121724,110104,42048,4821,9770,225285,21975,204447,152044,172659,16939,10442,160364,91664,24255,135606,105381,155776,228599,45807,2045,157813,44753,11194,27837,137471,65787,181935,6663,124991,174803,58770,138800,92792,216262,26708,192794,179367,117508,85353,109395,186159,10671,405,71291,50170,143168,52670,164762,137893,80884,227997,215911,40172,83421,233579,115040,28519,107210,133123,138177,12751,138832,85537,27898,83788,61628,30032,42593,95510,88288,207481,68588,35823,187111,176266,118881,140763,56980,55605,53716,66382,7502,46631,198187,205485,169838,133511,63646,160682,145259,60496,18420,174642,42852,100566,170058,160379,232660,185940,187163,179432,79705,78812,157910,26926,60368,197576,174306,26275,25046,4842,221483,63212,131828,120337,95072,182043,135885,217208,215343,134541,154760,233688,71761,188341,86440,79272,107046,17523,7468,220565,188296,225788,96148,110648,157068,218626,115184,143493,198917,107749,126873,154375,202349,110489,53157,126843,58390,43550,67788,200003,140817,118616,14665,98160,201399,143968,47121,204342,138618,217706,47843,73890,137566,197662,61902,72778,59598,122952,88114,2737,43773,127505,118524,173162,149156,130562,112257,119544,31011,102347,97308,163055,23624,121434,6847,182174,16670,68682,226353,209238,54363,47803,55869,53457,137841,228860,50816,204891,16682,68483,171291,82708,18973,206202};
        s.maximizeSquareArea(m, n, hFences, vFences);
    }
}